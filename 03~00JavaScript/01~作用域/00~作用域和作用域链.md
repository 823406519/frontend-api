
## 作用域是什么
编程语言最基本的功能就是通过变量的访问或者修改保存程序的状态。变量引入程序给我们带来了一下问题：
1. 变量存储在哪里
2. 如何找到这个变量

为了解决变量存储在哪里以及如何找到变量而设计的规则，就叫做作用域。

## 编译原理
1. 语法分析(tokennizing)：将代码字符串分解为token（词法单元)。如程序`var a = 2;`通常会被分解成下面这些词法单元
  * var
  * a
  * =
  * 2
  * ;

2. 将token转换为AST(抽象语法树)
3. 将AST转换为机器可执行的代码

## 编译器，引擎和作用域
1. 引擎。负责javascript的编译和执行
2. 编译器。引擎的一部分。负责语法分析和代码转换
3. 作用域。收集和维护已经声明的标识符(变量)查找列表，确定当前执行代码的变量访问规则。

对于`var a = 2;`,编译器会进行如下处理
1. 作用域是否存在已经存在该名称的标识符，如果存在，则进行编译，如果不存在，则在作用域注册。
 
2. 编译器接下来为引擎生成运行的代码。引擎运行需要使用变量，会查找作用域，如果存在，则使用它，如果不存在，则向上级作用域查找，直到抵达全局作用域为止(作用域链)。


## 作用域查找规则
查询可以分为LHS和RHS查询
  * 变量出现在左侧进行LHS查询。**查找变量本身**
  * 出现在后侧进行RHS查询 **查找变量的值**

## 作用域查找异常
1. RHS 查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出 ReferenceError 异常
2. **严格模式中**，LHS 查询失败时，并不会创建并返回一个全局变量，引擎会抛出同 RHS 查询失败时类似的 ReferenceError 异常。（非严格模式下会创建变量）
3. 如果 RHS 查询找到了一个变量，但是你尝试对这个变量的值进行不合理的操作，引擎会抛出另外一种类型的异常，叫作 TypeError

## 嵌套作用域与作用域链
在当前作用域无法找到某个变量时，就会在外层嵌套作用域中继续查找