参考文档：https://www.infoq.cn/article/DltDuLToZIk_ZRqfb4jG

# 浏览器渲染
1. 解析html标签，构建DOM tree，在构建DOM的过程中，如果遇到外联的样式声明和脚本声明，就暂停文档解析，创建新的网络连接，开始下载样式文件和脚本文件。
  - 在构建 DOM 时，HTML 解析器若遇到了 JavaScript，那么它会暂停构建 DOM，将控制权移交给 JavaScript 引擎，等 JavaScript 引擎运行完毕，浏览器再从中断的地方恢复 DOM 构建
  - 如果 JavaScript 想访问 CSSOM 并更改它，那么在执行 JavaScript 时，必须要能拿到完整的 CSSOM，在这种情况下，浏览器会先下载和构建 CSSOM，然后再执行 JavaScript，最后在继续构建 DOM
2. 解析css，构建css rule tree(CSS 规则树,)
3. 布局与绘制。根据渲染树来进行布局（也可以叫做回流）。弄清楚各个节点在页面中的确切位置和大小，布局完成后，浏览器会立即发出“Paint Setup”和“Paint”事件，将渲染树转换成屏幕上的像素。



  > DOM 树的结构变化以及几何属性的变化会导致页面重新渲染，这就是所谓的回流；而外观背景色等的操作不会引发布局变化导致重新渲染，这就是重绘。在前端开发中应当尽力避免回流来优化性能。（详细参考重绘与回流）

补充：脚本的渲染规则
1. `<script src="script.js"></script>`
浏览器立即加载并执行指定的脚本
2. `<script async src="script.js"></script>`
异步下载。无论此刻是 HTML 解析阶段还是 DOMContentLoaded 触发之后，已经加载好，就会开始执行。即async-script 可能在 DOMContentLoaded 触发之前或之后执行，但一定在 load 触发之前执行
3. `<script defer src="script.js"></script>`
载入 JavaScript 文件时不阻塞 HTML 的解析，执行阶段被放到 HTML 标签解析完成之后。